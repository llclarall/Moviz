<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphique SVG</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #333;
        }

        .bar {
            fill: #746e67;
        }

        .cassette-body {
            fill: #746e67;
            stroke: #252525;
            stroke-width: 1.5px;
        }

        .cassette-detail {
            fill: #c8c3b4;
        }

        .cassette-label {
            fill: #333;
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
        }

        .cassette-etiquette {
            fill: #f8f4e9;
        }

        .axis-line {
            stroke: #ffffff;
            stroke-width: 2;
        }

        .axis-label {
            fill: #ffffff;
            font-size: 12px;
        }

        #info-box {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            border-radius: 5px;
            background-color: #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>

    <div id="info-box">
        <strong>Informations sur le film</strong><br>
        Cliquez sur une barre pour voir les infos du film.
    </div>

    <svg id="barChart" width="920" height="550">
        <!-- Les axes restent fixes -->
        <line x1="10" y1="500" x2="900" y2="500" class="axis-line"></line> <!-- axe x -->
        <line x1="900" y1="500" x2="900" y2="500" class="axis-line"></line> <!-- flèche axe x -->
        <polygon points="910,500 900,495 900,505" fill="#ffffff"></polygon> <!-- triangle pour la flèche -->
        <line x1="10" y1="50" x2="10" y2="500" class="axis-line"></line> <!-- axe y -->
        <text x="10" y="520" class="axis-label">0</text>
        <text x="210" y="520" class="axis-label">250M</text>
        <text x="410" y="520" class="axis-label">500M</text>
        <text x="610" y="520" class="axis-label">750M</text>
        <text x="810" y="520" class="axis-label">1000M</text>
        <text x="350" y="550" class="axis-label">Revenus bruts (en $)</text>
    </svg>

    <script>
        // Fonction pour afficher les infos du film
        function showInfo(film) {
            const infoBox = document.getElementById('info-box');
            infoBox.innerHTML = `<strong>${film.title}</strong><br>Revenus bruts : ${film.boxOffice} $`;
        }

        // Charger les données depuis le fichier JSON
        fetch('./filmsDataEnriched.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des données.');
                }
                return response.json();
            })
            .then(films => {
                const svg = document.getElementById('barChart');
                let yPosition = 70; // Position verticale initiale

                films.forEach(film => {
                    // Nettoyer et convertir les revenus en nombre
                    const cleanedBoxOffice = film.boxOffice.replace(/,/g, '');
                    const boxOfficeValue = Number(cleanedBoxOffice);

                    // Vérifier si la valeur est valide
                    if (isNaN(boxOfficeValue)) {
                        console.warn(`Revenus invalides pour le film : ${film.title}`);
                        return;
                    }

                    // Calculer les dimensions
                    const barWidth = boxOfficeValue / 1250000;
                    
                    // Barre principale
                    const bar = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    bar.setAttribute("x", 15);
                    bar.setAttribute("y", yPosition);
                    bar.setAttribute("width", barWidth);
                    bar.setAttribute("height", 33);
                    bar.setAttribute("class", "bar");
                    bar.addEventListener("click", () => showInfo(film));
                    svg.appendChild(bar);
                    
                    // Ajouter les stripes à la barre
                    const stripeHeight = 22;
                    const stripeWidth = 10;
                    const gap = 6;
                    
                    for (let i = 0; i < Math.floor(barWidth / (stripeWidth + gap)); i++) {
                        const stripe = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                        stripe.setAttribute("x", 25 + i * (stripeWidth + gap));
                        stripe.setAttribute("y", yPosition + 5);
                        stripe.setAttribute("width", stripeWidth);
                        stripe.setAttribute("height", stripeHeight);
                        stripe.setAttribute("fill", "#c8c3b4");
                        svg.appendChild(stripe);
                    }

                    const cassetteWidth = 200;
                    
                    // Ajouter la cassette
                    const cassette = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    cassette.setAttribute("x", 10);
                    cassette.setAttribute("y", yPosition - 5);
                    cassette.setAttribute("width", cassetteWidth);
                    cassette.setAttribute("height", 45);
                    cassette.setAttribute("class", "cassette-body");
                    svg.appendChild(cassette);

                    // Lignes de détail de la cassette
                    for (let i = 0; i < 2; i++) {
                        const detail = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                        detail.setAttribute("x", 16 + i * 173);
                        detail.setAttribute("y", yPosition + 4);
                        detail.setAttribute("width", 15);
                        detail.setAttribute("height", 28);
                        detail.setAttribute("rx", "2");
                        detail.setAttribute("class", "cassette-detail");
                        svg.appendChild(detail);
                    }

                    // Etiquette de la cassette
                    const middleDetail = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    middleDetail.setAttribute("x", 40);
                    middleDetail.setAttribute("y", yPosition + 2);
                    middleDetail.setAttribute("width", 140);
                    middleDetail.setAttribute("height", 32);
                    middleDetail.setAttribute("class", "cassette-etiquette");
                    svg.appendChild(middleDetail);

                    // Ajouter le texte de la cassette
                    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    label.setAttribute("x", 110);
                    label.setAttribute("y", yPosition + 22);
                    label.setAttribute("class", "cassette-label");
                    label.textContent = film.title;
                    svg.appendChild(label);

                    // Augmenter la position verticale pour le prochain film
                    yPosition += 90;
                });
            })
            .catch(error => {
                console.error('Erreur lors du chargement ou du traitement des données :', error);
            });
    </script>

</body>
</html>
